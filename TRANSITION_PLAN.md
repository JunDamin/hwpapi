# hwpapi nbdev to Normal Python Package Transition Plan

## Overview

This document outlines the complete transition from nbdev to a normal Python package structure for the hwpapi project.

## Current State Analysis

### Structure
- **Source of truth**: 30 Jupyter notebooks in `nbs/` directory
- **Generated code**: 15 Python files in `hwpapi/` (auto-generated)
- **Build system**: nbdev with `settings.ini`
- **Dependencies**: `fastcore`, `pywin32`
- **Documentation**: nbdev-generated in `_docs/`

### Key Findings
1. All Python code in `hwpapi/` has `# AUTOGENERATED! DO NOT EDIT!` headers
2. Notebooks use nbdev-specific directives (`#| export`, `#| default_exp`)
3. Version managed by nbdev in `settings.ini`
4. Tests may be embedded in notebooks or in `tests/` directory

## Transition Plan: 5 Phases

### Phase 1: Preparation & Backup (Priority: Critical)
**Timeline**: 1 day
**Risk**: Low

#### Tasks:
1. **Create full backup**
   ```bash
   git checkout -b nbdev-backup
   git tag -a "v0.0.2.4-nbdev-backup" -m "Final nbdev state backup"
   ```

2. **Analyze notebook structure**
   - Map notebooks to generated Python files
   - Identify all `#| export` cells
   - Document current test locations

3. **Create transition branch**
   ```bash
   git checkout -b transition-to-normal-pkg
   ```

#### Deliverables:
- Backup branch and tag created
- Notebook-to-Python mapping document
- Current functionality verified

---

### Phase 2: New Package Structure Setup (Priority: Critical)
**Timeline**: 1-2 days
**Risk**: Low

#### Tasks:
1. **Create modern Python package structure**
   ```
   hwpapi/
   ├── src/
   │   └── hwpapi/
   │       ├── __init__.py
   │       ├── core.py
   │       ├── actions.py
   │       ├── functions.py
   │       ├── parametersets.py
   │       ├── constants.py
   │       ├── classes.py
   │       └── logging.py
   ├── tests/
   │   ├── __init__.py
   │   ├── test_core.py
   │   ├── test_actions.py
   │   ├── test_parametersets.py
   │   └── conftest.py
   ├── docs/
   ├── examples/
   ├── pyproject.toml
   ├── README.md
   ├── CHANGELOG.md
   └── LICENSE
   ```

2. **Create pyproject.toml**
   ```toml
   [build-system]
   requires = ["setuptools>=61.0", "wheel"]
   build-backend = "setuptools.build_meta"

   [project]
   name = "hwpapi"
   version = "0.1.0"  # Reset version for new structure
   description = "Python wrapper for HWPFrame.HwpObject using win32com"
   readme = "README.md"
   license = {text = "MIT"}
   authors = [
       {name = "JunDamin", email = "freedomgod@gmail.com"}
   ]
   classifiers = [
       "Development Status :: 4 - Beta",
       "Intended Audience :: Developers",
       "License :: OSI Approved :: MIT License",
       "Programming Language :: Python :: 3",
       "Programming Language :: Python :: 3.8",
       "Programming Language :: Python :: 3.9",
       "Programming Language :: Python :: 3.10",
       "Programming Language :: Python :: 3.11",
       "Programming Language :: Python :: 3.12",
   ]
   requires-python = ">=3.8"
   dependencies = [
       "fastcore",
       "pywin32; sys_platform == 'win32'",
   ]
   ```

3. **Update documentation structure**
   - Move relevant content from `_docs/` to `docs/`
   - Create README.md from project description

#### Deliverables:
- New package structure created
- `pyproject.toml` configured
- Basic documentation in place

---

### Phase 3: Code Migration (Priority: Critical)
**Timeline**: 3-5 days
**Risk**: Medium

#### Strategy: Manual Migration with Verification

**Option A: Clean Start (Recommended)**
1. Start with empty Python files
2. Manually port code from notebooks, removing nbdev artifacts
3. Write clean, idiomatic Python code
4. Add proper type hints and docstrings

**Option B: Automated Migration**
1. Extract code from notebook cells marked `#| export`
2. Remove nbdev-specific directives
3. Clean up formatting and imports

#### Migration Steps:
1. **Core modules migration**
   - `core.py`: App, Engine classes
   - `actions.py`: _Action, _Actions classes
   - `functions.py`: Utility functions

2. **Parameter sets migration**
   - `parametersets.py`: Largest file (~4100 lines)
   - Consider splitting into submodules as suggested in CLAUDE.md
   - Remove `# AUTOGENERATED! DO NOT EDIT!` headers

3. **Support modules**
   - `constants.py`, `classes.py`, `logging.py`
   - Update imports and dependencies

4. **Code cleanup during migration**
   - Remove nbdev-specific imports (`from nbdev.showdoc import *`)
   - Convert notebook-specific patterns to Python
   - Add proper type hints
   - Update docstrings to standard format

#### Deliverables:
- All code migrated to `src/hwpapi/`
- Imports working correctly
- Basic functionality preserved

---

### Phase 4: Testing & Verification (Priority: High)
**Timeline**: 2-3 days
**Risk**: Medium

#### Tasks:
1. **Set up pytest framework**
   ```bash
   pip install pytest pytest-cov
   ```

2. **Migrate existing tests**
   - Extract tests from notebooks if embedded
   - Move tests from `tests/` (if exists) to new structure
   - Convert nbdev test patterns to pytest

3. **Create comprehensive test suite**
   - Unit tests for each module
   - Integration tests (require HWP on Windows)
   - Use fixtures for COM object mocking

4. **Verification testing**
   - Install package in development mode
   - Run all examples from CLAUDE.md
   - Verify backward compatibility

#### Test Structure Example:
```python
# tests/test_core.py
import pytest
from unittest.mock import Mock
from hwpapi.core import App, Engine

class TestApp:
    def test_app_initialization(self):
        app = App()
        assert app is not None

    @pytest.mark.skipif(not pytest.config.getoption("--run-hwp"), 
                       reason="Requires HWP installation")
    def test_with_real_hwp(self):
        # Integration test with actual HWP
        pass
```

#### Deliverables:
- Full test suite passing
- Coverage report (>80%)
- Integration tests verified

---

### Phase 5: Documentation & Finalization (Priority: Medium)
**Timeline**: 2-3 days
**Risk**: Low

#### Tasks:
1. **Update documentation**
   - Create comprehensive README.md
   - Add API documentation (docstrings)
   - Migrate tutorials from notebooks to examples/
   - Update CLAUDE.md for new structure

2. **CI/CD setup**
   ```yaml
   # .github/workflows/test.yml
   name: Test
   on: [push, pull_request]
   jobs:
     test:
       runs-on: windows-latest
       strategy:
         matrix:
           python-version: [3.8, 3.9, 3.10, 3.11, 3.12]
       steps:
         - uses: actions/checkout@v3
         - name: Set up Python
           uses: actions/setup-python@v4
           with:
             python-version: ${{ matrix.python-version }}
         - name: Install dependencies
           run: |
             python -m pip install --upgrade pip
             pip install .[dev]
         - name: Run tests
           run: pytest --cov=hwpapi
   ```

3. **Final cleanup**
   - Remove nbdev directories (`nbs/`, `_docs/`)
   - Remove `settings.ini`
   - Update .gitignore
   - Clean up any remaining nbdev artifacts

4. **Release preparation**
   - Update version to 0.1.0
   - Create CHANGELOG.md
   - Test package installation from PyPI (if publishing)

#### Deliverables:
- Complete documentation
- CI/CD pipeline working
- Clean repository without nbdev artifacts

---

## Risk Mitigation

### High-Risk Items:
1. **Code migration errors**
   - **Mitigation**: Keep backup branch, test thoroughly
   - **Rollback**: `git checkout nbdev-backup` if needed

2. **Breaking existing functionality**
   - **Mitigation**: Comprehensive test suite, gradual migration
   - **Rollback**: Maintain both structures during transition

3. **Dependency issues**
   - **Mitigation**: Test on multiple Python versions
   - **Solution**: Update dependency specifications in pyproject.toml

### Medium-Risk Items:
1. **Test coverage gaps**
   - **Mitigation**: Start with existing tests, add more during migration
2. **Documentation inconsistencies**
   - **Mitigation**: Review and update all docs during Phase 5

---

## Timeline Summary

| Phase | Duration | Priority | Risk Level |
|-------|----------|----------|------------|
| Phase 1: Preparation | 1 day | Critical | Low |
| Phase 2: Structure Setup | 1-2 days | Critical | Low |
| Phase 3: Code Migration | 3-5 days | Critical | Medium |
| Phase 4: Testing | 2-3 days | High | Medium |
| Phase 5: Documentation | 2-3 days | Medium | Low |
| **Total** | **9-14 days** | | |

---

## Success Criteria

1. **Functional Success**:
   - All existing functionality preserved
   - Package installs and imports correctly
   - Tests pass on all supported Python versions

2. **Quality Success**:
   - Code coverage >80%
   - Clean, idiomatic Python code
   - Comprehensive documentation

3. **Maintainability Success**:
   - No nbdev dependencies
   - Standard Python package structure
   - Clear contribution guidelines

---

## Post-Transition Benefits

1. **Easier Development**:
   - Direct editing of Python files
   - Standard Python tooling (black, flake8, mypy)
   - Better IDE support

2. **Better Testing**:
   - pytest framework
   - Easy CI/CD integration
   - Better test organization

3. **Improved Distribution**:
   - Standard PyPI publishing
   - Better dependency management
   - Cleaner installation process

4. **Enhanced Documentation**:
   - Standard Python docs (Sphinx)
   - Better API documentation
   - More accessible examples

---

## Decision Points

1. **Package Structure**: `src/` layout vs flat layout (recommend `src/`)
2. **Parameter Sets Split**: Implement during transition or after (recommend during)
3. **Testing Strategy**: Mock COM objects vs require HWP (recommend both)
4. **Documentation Tool**: Sphinx vs MkDocs (recommend Sphinx for API docs)

---

## Next Steps

1. Review and approve this plan
2. Create backup branch and start Phase 1
3. Set up repository for transition work
4. Begin with low-risk phases to build momentum

---

*This plan should be reviewed and updated as the transition progresses.*